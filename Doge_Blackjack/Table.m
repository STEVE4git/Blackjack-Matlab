function Table(user)
% Doge_Blackjack initiates a uifigure (fig3) and the Blackjack game 
% environment. Doge_Blackjack incorporates features such as
% multiple betting options, balance tracking, restart, and cashout/exit.
%   Input arguements
%      user
%   Output arguements
%       None



temp_chips_bet = 0;

fig3 = uifigure('Name', 'Doge Blackjack',                               ...
                    'Position', [128 56 1280 720],                      ...
                    'Color', 'black', 'Pointer','hand', 'Visible', 'off');

    % Generates Blackjack table and dealer graphics.
fig_Start = uiimage(fig3, 'BackgroundColor', 'Black',                   ...
                         'Position', [0 0 1280 720]);
       fig_Start.ImageSource = 'backgrounds\Main.jpeg';

    % Balance appears in top left corner
        % Balance label
Balance_Label = uilabel(fig3, 'Position', [120 650 125 22],             ...
                             'HorizontalAlignment', 'right',            ...
                             'FontSize', 16, ...
                        'FontColor', [.15 .7 0], 'Text', 'Chips Balance  $');

        % Balance value
Balance = uieditfield(fig3, 'numeric', 'Limits', [0 Inf],               ...
                           'Editable', 'off',                           ...
                           'ValueDisplayFormat', '%9.0f',               ...
                           'FontSize', 16,                              ...
                           'FontColor', [.15 .7 0],                     ...
                           'HorizontalAlignment', 'center',             ...
                           'BackgroundColor', [0.1 0.1 0.1],            ...
                           'Position', [250 650 86 22], 'Value', user.money);
 

    % Chip label
Chip_Label = uilabel(fig3, 'HorizontalAlignment', 'center',             ...
                          'FontSize', 16,                               ...
                          'FontColor', [.8 .8 .8],                      ...
                          'Position', [185 615 63 22],                  ...
                          'Text', 'Chips');

    % Chip quantity owned
Chip_Qty = uieditfield(fig3, 'numeric', 'Limits', [0 Inf],         ...
                                 'ValueDisplayFormat', '%5.0f',         ...
                                 'Editable', 'off',                     ...
                                 'Position', [250 615 86 22],           ...
                                 'HorizontalAlignment', 'center',       ...
                                 'BackgroundColor', [0.1 0.1 0.1],      ...
                                 'FontSize', 16,                        ...
                                 'FontColor', [.8 .8 .8]);
                                Chip_Qty.Value = user.chips;

Cashout_Btn = uibutton(fig3, 'push', 'FontSize', 14,                    ...
                                     'FontWeight', 'bold',              ...
                                    'BackgroundColor', [0.15 0.15 0.15],...
                                     'FontColor', [.15 .7 0],           ...
                                     'Position', [350 649 150 26],      ...
                                     'Text', 'CASHOUT AND EXIT',        ...
                                'ButtonPushedFcn', @(Cashout_Btn, event)...
                                 Exit());
    function [] = Exit()
        uiconfirm(fig3, 'Do you wish to exit the game?',                ...
                    'Exit', 'Icon', 'warning', 'CloseFcn', @Exit_Game);
    end

    function Exit_Game(src, event)
        if event.SelectedOption == "OK"
            Cashout(Cashout_Btn, Chip_Bal, Start_Bal);
        end
    end


%       Betting
Current_Bet_Label = uilabel(fig3, 'HorizontalAlignment', 'center',      ...
                              'VerticalAlignment', 'center', 'Fontsize',...
                              18, 'FontColor', [1 0.4 0.15], 'Position',...
                              [150 525 98 23], 'Text', 'Current Bet');                 

%       Current Bet value displayed
Current_Bet = uieditfield(fig3, 'numeric', 'Limits', [0 Inf],          ...
                            'Editable', 'off', 'ValueDisplayFormat',    ...
                            '%9.0f', 'HorizontalAlignment', 'center',   ...
                            'FontSize', 18, 'FontColor', [1 0.4 0.15],  ...
                           'BackgroundColor', [0.1 0.1 0.1], 'Position',...
                            [265 525 108 24], 'Value', 0);


 Bet_spinner = uispinner(fig3, 'Position', [510 218 65 22],           ...
          'Limits', [1 user.chips], 'ValueChangedFcn', @(Bet_spinner,event)...
            start_betting(Bet_spinner));

function start_betting(Bet_spinner)

temp_chips_bet = Bet_spinner.Value;
Current_Bet.Value = Bet_spinner.Value;

end


Deal_Btn = uibutton(fig3, 'push', 'BackgroundColor', [0.9 0.9 0.9],     ...
                          'FontSize', 16, 'FontWeight', 'bold',         ...
                       'Position', [250 375 96 30], 'Text', 'DEAL EM!', ...
                          'ButtonPushedFcn', @(Deal_Btn, event)         ...
                          Deal_Lim(Deal_Btn, Current_Bet));

    function [] = Deal_Lim(Deal_Btn, Current_Bet)
        if Current_Bet.Value > 0
            user.chips = user.chips - temp_chips_bet*chip_val;
            user.curr_bet = Current_Bet.Value;
            user = Deal_Cards(Deal_Btn, Balance, Current_Bet_Label,            ...
                    Current_Bet, Btn_25, Btn_50, Btn_100, Btn_500,      ...
                    Btn_1000, Clr_Bet_Btn, Restart_Btn, Cashout_Btn, fig3,user);
            close(fig3);
            restart_game = uifigure('Name', 'Doge Blackjack',                               ...
                    'Position', [128 56 1280 720],                      ...
                    'Color', 'black', 'Pointer','hand', 'Visible', 'off');
           goto_cashier = uibutton(restart_game, 'push', 'BackgroundColor', [0.9 0.9 0.9],     ... 
                          'FontSize', 16, 'FontWeight', 'bold',         ...
                       'Position', [250 375 96 30], 'Text', 'Want to buy more chips?', ...
                          'ButtonPushedFcn', @(goto_cashier, event)call_cashier(goto_cashier, event));
                          function call_cashier(deal_btn, event)
                          Cashier(user);
                          end

            goto_table =  uibutton(restart_game, 'push', 'BackgroundColor', [0.9 0.9 0.9],     ... 
                          'FontSize', 16, 'FontWeight', 'bold',         ...
                       'Position', [250 375 96 30], 'Text', 'Want to play again?', ...
                          'ButtonPushedFcn', @(goto_table, event)call_table(goto_table, event));
                          function call_table(goto_table, event)
                          Table(user);

                          end

            quit =  uibutton(restart_game, 'push', 'BackgroundColor', [0.9 0.9 0.9],     ... 
                          'FontSize', 16, 'FontWeight', 'bold',         ...
                       'Position', [250 375 96 30], 'Text', 'Exit', ...
                          'ButtonPushedFcn', @(quit, event)quit_game(quit, event));
                          function quit_game(quit, event)
                          exit;
                          end



        end
    end

fig3.Visible = 'on';

end